---
id: pXkIJ
name: Certificate Download
file_version: 1.0.2
app_version: 0.6.3-1
file_blobs:
  src/main/java/com/tano/green/Main.java: 318886f138dfe24aca1c21f810e57b07919d5ed4
  src/main/java/com/tano/green/SSLConfig.java: e4b5d73b1328ee8d5692e87d1e279bae23775582
---

In this static block, It's the initialization of the application. We need to download certificates.

Initializing the GSON object ( for deserialization ) and OkHttpClient with SSL configuration.

<br/>


<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/main/java/com/tano/green/Main.java
```java
â¬œ 47         private static final String HEADER_RESUME_TOKEN = "x-resume-token";
â¬œ 48         private static ApiCertificate apiCertificate = null;
â¬œ 49     
ðŸŸ© 50         static {
ðŸŸ© 51     
ðŸŸ© 52             try {
ðŸŸ© 53                 System.out.println("Loading certificates");
ðŸŸ© 54     
ðŸŸ© 55                 Security.addProvider(new BouncyCastleProvider());
ðŸŸ© 56     
ðŸŸ© 57                 Gson gson = new GsonBuilder()
ðŸŸ© 58                         .setLenient()
ðŸŸ© 59                         .create();
ðŸŸ© 60                 OkHttpClient client = SSLConfig.getHttpClient();
ðŸŸ© 61                 Retrofit retrofit = new Retrofit.Builder()
ðŸŸ© 62                         .baseUrl(BASE_URL)
ðŸŸ© 63                         .addConverterFactory(ScalarsConverterFactory.create())
ðŸŸ© 64                         .addConverterFactory(GsonConverterFactory.create(gson))
ðŸŸ© 65                         .client(client)
ðŸŸ© 66                         .build();
ðŸŸ© 67     
ðŸŸ© 68                 apiCertificate = retrofit.create(ApiCertificate.class);
ðŸŸ© 69     
ðŸŸ© 70                 List<String> possibleKids = apiCertificate.getCertStatus().execute().body();
ðŸŸ© 71                 if (possibleKids == null || possibleKids.isEmpty()) {
ðŸŸ© 72                     throw new Exception("unable to complete certificate validation");
ðŸŸ© 73                 }
ðŸŸ© 74     
ðŸŸ© 75                 System.out.println(possibleKids.size() + " available kids");
ðŸŸ© 76     
ðŸŸ© 77                 // recursive function to fetch all available certificates
ðŸŸ© 78                 fetchCertificate("", possibleKids);
ðŸŸ© 79     
ðŸŸ© 80             } catch (Exception e) {
ðŸŸ© 81                 e.printStackTrace();
ðŸŸ© 82             }
ðŸŸ© 83         }
â¬œ 84     
â¬œ 85         private static void fetchCertificate(String resumeToken, List<String> possibleKids) throws CertificateException, IOException {
â¬œ 86     
```

<br/>

SSL configuration is done through the certificate I've downloaded from the browser at the URL: [https://get.dgc.gov.it/v1/dgc/signercertificate/update](https://get.dgc.gov.it/v1/dgc/signercertificate/update)

And put into the resource folder :

`ðŸ“„ src/main/resources/certificate.cer`

<br/>

<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/main/java/com/tano/green/SSLConfig.java
```java
â¬œ 29             InputStream cert = SSLConfig.class.getClassLoader().getResourceAsStream("certificate.cer");
â¬œ 30             Certificate ca = cf.generateCertificate(cert);
â¬œ 31     
ðŸŸ© 32             // Creating a KeyStore containing our trusted CAs
ðŸŸ© 33             String keyStoreType = KeyStore.getDefaultType();
ðŸŸ© 34             KeyStore keyStore   = KeyStore.getInstance(keyStoreType);
ðŸŸ© 35             keyStore.load(null, null);
ðŸŸ© 36             keyStore.setCertificateEntry("ca", ca);
ðŸŸ© 37     
â¬œ 38             // Creating a TrustManager that trusts the CAs in our KeyStore.
â¬œ 39             String tmfAlgorithm = TrustManagerFactory.getDefaultAlgorithm();
â¬œ 40             TrustManagerFactory tmf = TrustManagerFactory.getInstance(tmfAlgorithm);
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/#/repos/Z2l0aHViJTNBJTNBZ3JlZW5wYXNzLXZlcmlmeSUzQSUzQUdhZXRhbm9QaWF6em9sbGE=/docs/pXkIJ).